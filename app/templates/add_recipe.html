{% extends "base.html" %}

{% block content %}

<h1>{% if form.is_edit %}Edit Recipe{% else %}Add a New Recipe{% endif %}</h1>

<form action="" method="post" novalidate>
    {{ form.hidden_tag() }}

    <!-- Recipe Name Field -->
    <p>
        {{ form.name.label }}<br>
        {{ form.name }}<br>
        {% for error in form.name.errors %}
        <span style="color: red;">[{{ error }}]</span>
        {% endfor %}
    </p>

    <!-- Author Field -->
    <p>
        {{ form.author.label }}<br>
        {{ form.author }}<br>
        {% for error in form.author.errors %}
        <span style="color: red;">[{{ error }}]</span>
        {% endfor %}
    </p>

    <h2>Ingredients</h2>

    <!-- Ingredients List -->
    <div id="ingredients">
        {% for ingredient in form.ingredients %}
        <div>
            <p>
                <!-- Ingredient Name Input -->
                {{ ingredient.name.label }}<br>
                {{ ingredient.name }}<br>
                {% for error in ingredient.name.errors %}
                <span style="color: red;">[{{ error }}]</span>
                {% endfor %}
            </p>
            <p>
                <!-- Ingredient Amount Input -->
                {{ ingredient.amount.label }}<br>
                {{ ingredient.amount }}<br>
                {% for error in ingredient.amount.errors %}
                <span style="color: red;">[{{ error }}]</span>
                {% endfor %}
            </p>
            <p>
                <!-- Ingredient Unit Dropdown -->
                {{ ingredient.unit.label }}<br>
                {{ ingredient.unit() }}<br>
                {% for error in ingredient.unit.errors %}
                <span style="color: red;">[{{ error }}]</span>
                {% endfor %}
            </p>
        </div>
        {% endfor %}
    </div>
    
    <!-- Add More Ingredients Button -->
    <p>
        <button type="button" onclick="addIngredient()">Add More Ingredients</button>
    </p>

    <h2>Instructions</h2>

    <!-- Instructions List -->
    <div id="instructions">
        {% for instruction in form.instructions %}
        <div>
            <p>
                {{ instruction.task.label }}<br>
                {{ instruction.task }}<br>
                {% for error in instruction.task.errors %}
                <span style="color: red;">[{{ error }}]</span>
                {% endfor %}
            </p>
        </div>
        {% endfor %}
    </div>
    
    <!-- Add More Instructions Button -->
    <p>
        <button type="button" onclick="addInstruction()">Add More Instructions</button>
    </p>

    <!-- Submit Button -->
    <p>{{ form.submit() }}</p>
</form>

<!-- JavaScript to Add Dynamic Fields -->
<script>
    function addIngredient() {
        const ingredientsDiv = document.getElementById('ingredients');
        const newIngredient = ingredientsDiv.firstElementChild.cloneNode(true);
        const totalIngredients = ingredientsDiv.childElementCount;
        newIngredient.querySelectorAll('input, select').forEach(function (input) {
            input.name = input.name.replace(/\d+/, totalIngredients);
            input.id = input.id.replace(/\d+/, totalIngredients);
            input.value = '';  // Reset input values
        });
        ingredientsDiv.appendChild(newIngredient);
    }

    function addInstruction() {
        const instructionsDiv = document.getElementById('instructions');
        const newInstruction = instructionsDiv.firstElementChild.cloneNode(true);
        const totalInstructions = instructionsDiv.childElementCount;
        newInstruction.querySelectorAll('textarea').forEach(function (textarea) {
            textarea.name = textarea.name.replace(/\d+/, totalInstructions);
            textarea.id = textarea.id.replace(/\d+/, totalInstructions);
            textarea.value = '';  // Reset textarea values
        });
        instructionsDiv.appendChild(newInstruction);
    }
</script>

{% endblock %}
